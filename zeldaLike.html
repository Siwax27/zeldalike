<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Mon 1er jeu Phaser</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.51.0/dist/phaser.js">
    </script>

    <style type="text/css"> body 
    
        { margin: 0; 
        }
 
        #endGame{
            display: none;
            font-size: 100px;
            color: red;
            padding-top: 230px;
            padding-left:110px ;
            position:absolute;
            z-index:1
        }

        
    
    </style>
</head>
<body>
    <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 320, height: 320,
            physics: {
            default: 'arcade',
            arcade: {
            debug: true
            }},
            scene: {preload: preload, create: create, update: update },
            input : {gamepad:true},
            };

        new Phaser.Game(config);  
          

        function preload(){

            this.load.image("Phaser_tuilesdejeu", "assets/toutesleszones.png");

            this.load.tilemapTiledJSON("carte", "assets/niveau.json");  
            this.load.tilemapTiledJSON("carteP","assets/niveauP.json");
            this.load.spritesheet('perso','assets/testhero.png',
            { frameWidth: 32, frameHeight: 32 });

            this.load.spritesheet('slime','assets/slimetest.png',
            { frameWidth: 32, frameHeight: 32 });
            this.load.spritesheet('vieentier','assets/vieentier.png',
            { frameWidth: 128, frameHeight: 32 });
            this.load.spritesheet('vie2','assets/vie2.png',
            { frameWidth: 128, frameHeight: 32 });
        }
        var player;
        var cursors;
        var monstre;
        var monstre2;
        var monstre3;
        var vie;
        var monstreDirection = 0;
        var monstreDirection2 = 0;
        var monstreDirection3 = 0;
        var keyA;
        function create (){

            cursors = this.input.keyboard.createCursorKeys();
            const carteDuNiveau = this.add.tilemap("carte");

            // importer les TileSet 
            const tileset = carteDuNiveau.addTilesetImage(
                    "zones",
                    "Phaser_tuilesdejeu"
                    );  
                const tilesetP = carteDuNiveau.addTilesetImage(
                    "zones2",
                    "Phaser_tuilesdejeu"
                    );
            const plateformes = carteDuNiveau.createStaticLayer(
                    "zonePlaine",
                    tileset
                    );
            const plateformesP = carteDuNiveau.createStaticLayer(
                    "passe",
                    tilesetP
                    );
            player = this.physics.add.sprite(32,32,'perso'); 
            monstre = this.physics.add.sprite(32,32,'slime');
            monstre2 = this.physics.add.sprite(32,32,'slime');
            monstre3 = this.physics.add.sprite(32,32,'slime');   
            vie = this.physics.add.sprite(50,10,'vieentier').setScale(0.75).refreshBody();
            this.physics.add.collider(player, plateformes);
            this.physics.add.collider(monstre, plateformes);
            this.physics.add.collider(monstre2, plateformes);
            vie.setScrollFactor(0)
            plateformes.setCollisionByProperty({ estSolide: true });   
            player.body.setSize(20, 20, 10, 0);
            monstre.body.setSize(20, 10);
                monstre.setOffset(5,20);
            monstre2.body.setSize(20, 10);
                monstre2.setOffset(5,20);
            monstre3.body.setSize(20, 10);
                monstre3.setOffset(5,20);
            monstre.x = 70;
            monstre.y = 50;
            monstre2.x = 270;
            monstre2.y = 110;
            player.x = 400
            player.y = 900
            monstre3.x = 400
            monstre3.y = 970
            this.physics.world.setBounds(0, 0, 960, 1280);
            this.cameras.main.setBounds(0, 0, 960,1280);
            this.cameras.main.setSize(320,320);
            this.cameras.main.startFollow(player);
            
        
            player.setBounce(0.2);
            monstre.setCollideWorldBounds(true);
            player.setCollideWorldBounds(true);
            this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('perso', {start:4,end:7}),
            frameRate: 10,
            repeat: -1
            });
            this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('perso', {start:8,end:11}),
            frameRate: 10,
            repeat: -1
            });
            this.anims.create({
            key: 'up',
            frames: this.anims.generateFrameNumbers('perso', {start:12,end:15}),
            frameRate: 10,
            repeat: -1
            });
            this.anims.create({
            key: 'down',
            frames: this.anims.generateFrameNumbers('perso', {start:0,end:3}),
            frameRate: 10,
            repeat: -1
            });
            this.anims.create({
            key: 'turn',
            frames: [ { key: 'perso', frame: 0 } ],
            frameRate: 20
            });

            this.input.keyboard.enabled = true
            keyA = this.input.keyboard.addKey('a');


        }
        
        function update(){   
            if (cursors.left.isDown){ //si la touche gauche est appuyée
                    player.setVelocityX(-160); //alors vitesse négative en X
                    player.anims.play('left', true); //et animation => gauche
            }else{
                player.setVelocityX(0);
            }
            if (cursors.right.isDown){ //si la touche droite est appuyée
                    player.setVelocityX(160); //alors vitesse positive en X
                    player.anims.play('right', true); //et animation => droite
            }
            if (cursors.up.isDown){// si la touche haut est appuyée 
                    player.setVelocityY(-160);//alors vitesse positive en Y 
                    player.anims.play('up', true);// et animation => haut
            }else{
                player.setVelocityY(0);
            }
            if (cursors.down.isDown){//si la touche bas est appuyée 
                    player.setVelocityY(160);//alors vitesse positive en Y
                    player.anims.play('down', true); 
            }
            if (Phaser.Input.Keyboard.JustDown(keyA)){
                
            }

            if (monstreDirection == 0) {
                monstre.x = monstre.x +1
                if(monstre.x >= 270) {
                    monstreDirection = 1;
                }
            }
            else if (monstreDirection == 1)
                {
                    monstre.y = monstre.y + 1;
                    if(monstre.y >= 120) {
                        monstreDirection = 2;
                    }
            }
            else if (monstreDirection == 2) {
                monstre.x = monstre.x -1
                if(monstre.x == 50) {
                    monstreDirection = 3;
                }
            }
            else if (monstreDirection == 3) {
                monstre.y = monstre.y - 1;
                if (monstre.y <= 50) {
                    monstreDirection = 0;
                }
            }
            
            if (monstreDirection2 == 0) {
                monstre2.x = monstre2.x +1
                if(monstre2.x >= 270) {
                    monstreDirection2 = 1;
                }
            }
            else if (monstreDirection2 == 1)
                {
                    monstre2.y = monstre2.y + 1;
                    if(monstre2.y >= 120) {
                        monstreDirection2 = 2;
                    }
            }
            else if (monstreDirection2 == 2) {
                monstre2.x = monstre2.x -1
                if(monstre2.x == 50) {
                    monstreDirection2 = 3;
                }
            }
            else if (monstreDirection2 == 3) {
                monstre2.y = monstre2.y - 1;
                if (monstre2.y <= 50) {
                    monstreDirection2 = 0;
                }
            }
            if (monstreDirection3 == 0) {
                monstre3.x = monstre3.x +1
                if(monstre3.x >= 500) {
                    monstreDirection3 = 1;
                }
            }
            else if (monstreDirection3 == 1)
                {
                    monstre3.y = monstre3.y + 1;
                    if(monstre3.y >= 1160) {
                        monstreDirection3 = 2;
                    }
            }
            else if (monstreDirection3 == 2) {
                monstre3.x = monstre3.x + 1
                if(monstre3.x == 600) {
                    monstreDirection3 = 3;
                }
            }
            else if (monstreDirection3 == 3) {
                monstre3.y = monstre3.y - 1;
                if (monstre3.y <= 1260) {
                    monstreDirection3 = 4;
                }
            }
            else if (monstreDirection3 == 4) {
                monstre3.x = monstre3.x - 1;
                if (monstre3.x <= 460) {
                    monstreDirection3 = 5;
                }
            }
            else if (monstreDirection3 == 5) {
                monstre3.y = monstre3.y - 1;
                if (monstre3.y <= 1080) {
                    monstreDirection3 = 6;
                }
            }
            else if (monstreDirection3 == 6) {
                monstre3.x = monstre3.x - 1;
                if (monstre3.x <= 400) {
                    monstreDirection3 = 7;
                }
            }
            else if (monstreDirection3 == 7) {
                monstre3.y = monstre3.y - 1;
                if (monstre3.y <= 970) {
                    monstreDirection3 = 0;
                }
            }

    }

        
    </script>
</body>
</html>